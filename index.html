<!DOCTYPE html>
<html>
<head>
   <title>ai_corpora</title>
   <meta content="width=device-width, initial-scale=1" name="viewport" />
</head>
   <body>
     <style>/* PC */
        html, body { height: 100%; width:100%; background:black; margin:0}
        body{display:flex;flex-direction:column;overflow: hidden;
         justify-content:space-evenly;align-items:center;}
        hr{width:97%;border: 2px solid steelblue;border-radius: 13px;margin-bottom:1.444em;
            box-shadow: -5px 1px 5px 1px purple;margin-top:0.888em;}
        .subDIVIDER{width:96%;border:1px solid steelblue;margin-bottom:1.444em;
            box-shadow: 2px 1px 2px 1px aqua;margin-top:0.888em;border-radius: 13px;}
         .topLeftBtn1{position:absolute;top:3px;left:6px;display:flex;}
         .topLeftBtn1 .txt1{ color:skyblue; font-size:0.444em;margin:3px 0 0 3px;}
         .topLeftBtn1 .icon1 {font-size:1em;padding-bottom:6px;}
         .topRightBtn2{position:absolute;top:3px;right:6px;display:flex;}
         .topRightBtn2 .txt1{ color:skyblue; font-size:0.444em;margin:3px 0 0 3px;}
         .topRightBtn2 .icon1 {font-size:1em;padding-bottom:6px;}
         .docSaveBtn {cursor:pointer;border-radius: 22px;background: #c975a0;color: #5e1717;}
         .docDeleteBtn {font-size:1em;cursor:pointer;border-radius: 100%; background: #34010b; margin:0 0.666em;}
         .docUpdateBtn {cursor:pointer;border-radius: 22px;background: #6bb8e1;color: #314481;}
         .docSavedBtn {font-size:0.888em;color:gold;box-shadow: 1px 1px 1px gold;
            padding: 0.222em;border-radius: 24em;background: black; cursor: pointer;
         }
         h4{margin:0.222em 0;}
         .docRowBox {display:flex;margin: 0.333em;flex-wrap:wrap;align-items: center;}
         .docTopicBtn {cursor:pointer;border-radius: 13px;background: darkslategrey;
            color: skyblue; font-size: 0.666em; padding: 6px;}
         .recInputTitle {border-radius: 13px;background: darkslateblue;width:10em;
            color: skyblue; font-size:1em;margin-right:0.444em;padding: 6px;}
         .docTopicBtn:hover{border:2px solid steelblue}
         .BtnHover:hover{border:2px solid steelblue}
        .mainBtn{margin:1em; color:black;border:1px solid royalblue;} 
        .mainBtn:hover{border:2px solid steelblue; color:darkslategrey}
        .subBtn{
            margin:0.222em; color:black;border:1px solid royalblue;
            display: flex;align-items: center;
        } 
        .subBtn:hover{border:2px solid steelblue; color:darkslategrey}
        .subMenuBtn { 
            color:#001d1b; border-radius: 13px;  
            background-image: linear-gradient(grey, steelblue, black);
            margin: 0.666em 0.222; cursor:pointer;font-size:0.888em; padding: 2px 6px 4px 6px; 
            border: 1px solid blue;
        }
        .btnTXT{font-size:1em;}
        /* .btnTXT:hover{color:navajowhite;} */
        .hoverTXT:hover{color:darkblue;}
        /* .mainBtn:hover{color:navajowhite} */
        /* .btnTXT:hover{color:navajowhite} */
        .subMenuBtn:hover{border:2px solid steelblue; color:darkslategrey}

        .disabled{ color: darkslategrey; border: 1px solid steelblue; 
            background: transparent !important;}
        .hiddenTab{ display:none !important;}
         #textareaBOX {
            background:darkslateblue;
            background-attachment: local;
            background-image:
               linear-gradient(to right, darkslateblue 20px, transparent 20px),
               linear-gradient(to left, darkslateblue 20px, transparent 20px),
               repeating-linear-gradient(darkslateblue, darkslateblue 40px, #344065 40px, #344065 41px, darkslateblue 41px);
            line-height: 31px;
            padding: 8px 10px;
            max-width: 44em;
         }
        .speakGlow{box-shadow: 0px 0px 10px 0px limegreen !important;}
        .recGlow{box-shadow: 0px 0px 10px 0px limegreen !important;}
        
      @media only screen and (max-width: 800px) { /* TABLET */
         body{  background-color: #04223c;}
         .btnTXT{font-size:0.888em;}
         /* .mainBtn{margin:0.888em;} */
         .subMenuBtn{font-size:0.888em;}
      }  
      @media only screen and (max-width: 500px) { /* PHONE */
         body{ background-color: #02051e;}
         .btnTXT{font-size:0.888em;}
         /* .mainBtn{margin:0.222em;} */
         .subMenuBtn{font-size:0.777em;}
         #MAINFRAME{width: 97% !important;}
         #textareaFrame{ width: 93% !important;}
         #textareaBOX{ width: 90% !important; margin: 0 auto !important;}
         #allchatBOX{width: 90%!important;}
         #infoBOX{width: 92%!important;}
         #audioBOX{width: 90%!important;}
         
      }

      /*  custom scroll bar */
      .scrollBarV {height:97%; overflow-x:scroll; background:#010111; border: 1px steelblue solid; border-radius:13px;  }
      .scrollBarV::-webkit-scrollbar-track { background-color: #010213;  border-radius: 13px; }
      .scrollBarV::-webkit-scrollbar { width: 0.666em; height: 100%; }
      .scrollBarV::-webkit-scrollbar-thumb { background-color: #04223c; border-radius: 13px;
      background-image: -webkit-linear-gradient(0deg, rgba(255, 255, 255, 0.6) 26%, transparent 26%, transparent 51%, rgba(255, 255, 255, -0.4) 51%, rgba(255, 255, 255, 0.6) 74%, transparent 74%, transparent);
      }

     </style>
     <aside class="topLeftBtn1">
      <button class="icon1 BtnHover" style="border-radius:100%;background:steelblue; 
      border:2px solid grey;">üé™</button><span class="txt1">home</span>
      </aside>
      <aside style="font-size: 0.666em;color: steelblue;margin: 2px 0 4px 0;">
         ai_corpora</aside>
      <aside class="topRightBtn2">
         <span class="txt1">charts</span>
         <button class="icon1 BtnHover" style="border-radius:100%;background:crimson; 
         border:2px solid grey;">üé¢</button>
         </aside>      
      <header style="display:flex;justify-content:space-evenly;
        background-image: linear-gradient(grey, steelblue, black);
        box-shadow:0 0 14px 0px steelblue;border-radius:13px; margin: 1em auto 0.111em auto;
        width:98%; flex: 0 0 auto;">
         <button id="speakBtn" class="mainBtn" onclick="showTXT()" style="border-radius:8px;
            background:grey; 
            cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
            <span style="border-radius:100%;background:limegreen;
              border:1px solid grey;">
            üñãÔ∏è</span><span style="color:black;" class="btnTXT hoverTXT">aSCRIBEa</span>
         </button>

         <section id="recordingBox" class="mainBtn" style="border-radius:8px;
         background:limegreen;padding: 6px; display:none;">
            <span>üéß</span> Recording üé§ 
        </section>

         <section id="listeningBox" class="mainBtn" style="border-radius:8px;
         background:limegreen;padding: 6px; display:none;">
            <span>üî¥</span> Transcribe üéôÔ∏è 
        </section>

         <section id="notlisteningBox" class="mainBtn" style="border-radius:8px;
         background:#6283be;padding: 6px;border: 1px solid darkslateblue;color:#444;
         font-family: monospace;font-size: 0.777em;
            "><span style="border-radius:33%;background:#777;
              border:1px solid grey;">
            üîà</span>Not recording
        </section>

         <section id="savedBox" class="mainBtn" style="border-radius:20px;
            background:rgb(249, 231, 130);padding:4px 4px 8px 4px;display:none;
            border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
            ">üíæ saved.</section>

         <section id="copiedBox" class="mainBtn" style="border-radius:20px;
            background:#fad688;padding:4px 4px 8px 4px;display:none;
            border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
            ">üé≠ copied.</section>

         <section id="errorBox" class="mainBtn" style="border-radius:20px;
            background:#091d3e;padding:4px 4px 8px 4px;display:none;
            border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
            ">‚ö†Ô∏è error...</section>

         <button class= "mainBtn " onclick="showAUDIO()" style="border-radius:8px;
            background:grey;box-shadow: inset 0px 0px 10px 0px purple;
            cursor:pointer;"><span style="border-radius:100%;background:purple;
              border:1px solid grey;">
            üé§</span><span class="btnTX hoverTXT">aRECORDa</span>
         </button>
        </header>
    <main id="MAINFRAME" style="display:flex;flex-direction:column;margin:0.222em;padding:0.444em 0;
        border:1px solid aqua;
        width:92%;align-items: center;" class="scrollBarV">
        <section id="infoBOX"  class="hiddenTab scrollBarV" 
            style="width:80.888%;max-width:44em;margin: 0.222em 2% 0.111em 2%;border-radius: 13px; 
            border: solid 1px steelblue; box-shadow: 1px 1px 11px 0px cyan;
                padding: 1% 0 1% 2%; color: cyan;flex: 1;display: flex;flex-direction: column;overflow-y: scroll;">
           <header style="font-size: 0.999em; display:flex;flex: 0 0 auto;">
            üåé INFO üõ∞Ô∏è: 
           </header>
           <hr>
           <main style="margin-left:1em;">
            <h2>‚ö° Voice, Audio, Video, Haptic Text:</h2>
            <section>- editor recorder (assistant):</section> 
            <article>- classify and encode </article>
            <article>- preprocess and train corpora</article>
            <article>- as aXTRaTXTa in AXI_ai</article>
            <br>
            <i>Demonstrates ai data collection,</i><br>
            <i>for EDUCATIONAL PURPOSES.</i>
            <br>
            <hr class="subDIVIDER">
            <h3>üîÆ ABILITIES:</h3>
            <article>Click üé§ SPEAK, to ascribe your voice to text.</article>
            <article>Click üî¥ REC, to record your voice to wav.</article>
            <article>Click üíø SAVE TXT.</article>
            <article>Click üìÄ SAVE WAV.</article>
            <article>View üè∞ SAVED, in üé° ALL TXTS.</article>
            <hr class="subDIVIDER">
            <h3>üéà TOOLS:</h3>
            <article>#Ô∏è‚É£means:HEADER</article>
            <article>üî†means:ALPHA_TOKEN</article>
            <article>üî¢means:BETA_TOKEN</article>
            <article>üî£means:CAPPA_TOKEN</article>
            <article>*Ô∏è‚É£means:DELTA_TOKEN</article>
            <hr class="subDIVIDER">
            <h3>üè∞ SAVE DATA:</h3>
            <article>COPY TXT with the üìã copy button.</article>
            <article>DOWNLOAD Audio with üé¨ download btn. button.</article>
            <br>
            <br>
          </main>
        </section>

        <section id="allchatBOX"  class="hiddenTab scrollBarV" 
            style="width:80.888%;max-width:44em;margin: 0.222em 2% 0.111em 2%;border-radius: 13px; 
            border: solid 1px steelblue; box-shadow: 1px 1px 11px 0px darkorchid;
                padding: 1% 0 1% 2%; color: cyan;flex: 1;display: flex;flex-direction: column;overflow-y: scroll;">
           <header style="font-size: 0.888em; display:flex;flex: 0 0 auto;">
            üõ∞Ô∏è SAVE locally üåé: 
           </header>
           <hr>
           <header style="display:flex;flex: 0 0 auto;">
            <button class="BtnHover" onclick="backChatFn()"  style="font-size:0.666em;padding:0.444em;border-radius:13px;
            box-shadow: inset -1px -1px 4px 1px rgb(112, 123, 243);cursor:pointer;background: #be75c8;">
            ‚è™ Back to TXT  ‚è™</button>
            <button class="BtnHover" onclick="newChatFn()"  style="font-size:0.666em;padding:0.444em;border-radius:13px;
            box-shadow: inset -1px -1px 4px 1px rgb(112, 123, 243);cursor:pointer;background: #be75c8;">
            üìú New TXT üìú</button>
           </header>
           <hr class="subDIVIDER">
           <h4>TXTz</h4>
           <article id="allChatsMenu" style="display:flex;flex-direction:column;
                 align-items:flex-start;flex:1;
                  margin-right: 1%;">
           </article>
           <hr class="subDIVIDER">

        </section><!--end info-->

        <section id="textareaFrame"  
        style="width:80.888%;max-width:44em;margin: 0.222em 2% 0.111em 2%;border-radius: 13px; 
            border: solid 1px steelblue; box-shadow: 1px 1px 11px 0px dodgerblue;
            padding: 1% 0 1% 0; color: cyan;flex: 1;display: flex;flex-direction: column;overflow:hidden;">
    <header style="display: flex;">
       <h4 style="margin: 0.888em 0 1em 1em;">üéôÔ∏è ASCRIBE (voice to txt):</h4>
       <aside style="height: 2em;
        border-radius: 10px;margin: 0.444em 0 0 1em;
        display:flex;padding: 4px;
        box-shadow: inset -1px -1px 4px 1px rgb(83, 93, 204);">
        <button id="recBtnTXT" class="subBtn" onclick="recTXT()" style="border-radius:8px;
        background:grey; height: 2em;
        cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
        <span style="border-radius:100%;background:limegreen;
            border:1px solid grey;">
        üî¥</span><span style="color:black;" class="btnTXT hoverTXT">REC</span>
        </button>
        <button class= "subBtn" onclick="stopTXTRecord()" style="border-radius:8px;
        background:grey;box-shadow: inset 0px 0px 10px 0px crimson;
        cursor:pointer;"><span style="border-radius:100%;background:firebrick;
          border:1px solid grey;">
        ‚õî</span><span class="btnTX hoverTXT">STOP</span>
     </button>
        </aside>
    </header>
        <textarea id="textareaBOX" onmouseup="setCursorRowFn()" class="scrollBarV"
            style="width:80.888%;
            margin: 0.222em auto 0.111em auto;
            display:flex;flex:1;
            border-radius: 13px; border: solid 1px steelblue; box-shadow: 1px 1px 11px 0px cyan;
            padding: 4% 2% 4% 2%; color: cyan; line-height: 2.444em;" spellcheck="false"
            onkeyup="keyupTXT();">Click REC and speak - to Transcribe TXTz.
        </textarea>
        <footer style="display: flex;justify-content: space-around;">
    <button class="mainBtn" onclick="copyChatFn()" style="border-radius:8px;background:grey;
      cursor:pointer;box-shadow: inset -1px -1px 4px 1px orangered;">
      <span style="border-radius:100%;background:orangered;border:1px solid grey;">
        üìã</span> <span class="btnTXT hoverTXT">COPY TXT</span>
   </button>
      <button class="mainBtn" onclick="saveCHAT()" style="border-radius:8px;
         background:grey; 
         cursor:pointer;box-shadow: inset 0px 0px 10px 0px yellow;">
         <span style="border-radius:100%;background:orange;
           border:1px solid grey;">
         üé°</span><span class="btnTXT hoverTXT">SAVE TXT</span>
    </button>
        </footer>
        <menu style="display:flex;justify-content:space-evenly;
        margin:0;padding:0;margin-top:-6px;border-radius: 30px;
        box-shadow: inset -2px -8px 17px 0px #3737cf;background: #182b3d;
        flex: 0 0 auto;flex-wrap: wrap;">
     <button class="subMenuBtn" onclick="newChatFn()">*NEW*</button>
     <button class="subMenuBtn" onclick="alphaFn()">ATOMüîë</button>
     <button class="subMenuBtn" onclick="omniFn()">SUBATOMüóùÔ∏è</button>
     <button class="subMenuBtn" onclick="primeFn()">_BARüóù</button>
     <button class="subMenuBtn" onclick="sigFn()">AUTH<span style="font-size: 0.777em;
        padding-left: 2px;">üìÖ</span></button>
     <button class="subMenuBtn" onclick="ymdFn()">YMD<span style="font-size: 0.777em;
        padding-left: 2px;">üìÖ</span></button>
    </menu>    
    <menu style="display:flex;justify-content:space-evenly;background: #182b3d;
        flex: 0 0 auto;flex-wrap: wrap;
        border-radius: 30px;margin:0;padding:0;margin-bottom:-6px;
        box-shadow: inset -5px 7px 8px 0px #472c88;">
        <button class="subMenuBtn" onclick="undoFn()">‚Ü∂undo</button>
        <button class="subMenuBtn" onclick="titlelineFn()">#Ô∏è‚É£title</button>
        <button class="subMenuBtn" onclick="numberlineFn()">üî¢1.2.3.</button>
        <button class="subMenuBtn" onclick="endlineFn()">üî£.,_?!</button>
        <button class="subMenuBtn" onclick="quotelineFn()">*Ô∏è‚É£quote</button>
        <button class="subMenuBtn" onclick="hyphenFn()"><span style="font-size: 0.777em;
            ">- </span></button>            
         <button class="subMenuBtn" onclick="hrFn()"><span style="font-size: 0.777em;
            ">__</span></button>
         <button class="subMenuBtn" onclick="pipeFn()"><span style="font-size: 0.777em;
            ">|</span></button>
    </menu>        
      </section>

    <section id="audioBOX"  class="hiddenTab scrollBarV" 
        style="width:80.888%;max-width:44em;margin: 0.222em 2% 0.111em 2%;border-radius: 13px; 
        border: solid 1px steelblue; box-shadow: 1px 1px 11px 0px forestgreen;
            padding: 1% 0 1% 2%; color: cyan;flex: 1;display: flex;flex-direction: column;overflow-y: scroll;">
    <header style="display: flex;">
       <h4 style="margin: 0.888em 0 0.444em 0em;">üéôÔ∏è RECORD (voice to wav):</h4>
       <aside style="height: 2em;
        border-radius: 10px;margin: 0.666em 0 0 1em;
        display:flex;padding: 4px;
        box-shadow: inset -1px -1px 4px 1px rgb(83, 93, 204);">
        <button id="recBtnAUDIO" class="subBtn" onclick="recAUDIO()" style="border-radius:8px;
        background:grey; height: 2em;
        cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
        <span style="border-radius:100%;background:limegreen;
            border:1px solid grey;">
        üî¥</span><span style="color:black;" class="btnTXT hoverTXT">REC</span>
        </button>
        <button class= "subBtn " onclick="stopAUDIORecord()" style="border-radius:8px;
        background:grey;box-shadow: inset 0px 0px 10px 0px crimson;
        cursor:pointer;"><span style="border-radius:100%;background:firebrick;
          border:1px solid grey;">
        ‚õî</span><span class="btnTX hoverTXT">STOP</span>
     </button>
        </aside>
    </header>
    <hr>
    <main style="margin-left:1em;">
        <h4 id="NotRecWav">Not Recording.</h4>
        <aside id="RecWavTimer" style="display:none;"><h3>Recording:</h3>
            <time id="RecTime" style="color:aqua;font-size:4.444em;
            display:flex;justify-content: space-around;">00:00
            </time>
        </aside>
        <hr class="subDIVIDER">
        <h3>WAVz:</h3>
        <article id="allAudiosMenu" style="display:flex;flex-direction:column;
            align-items:flex-start;border: 1px solid steelblue;border-radius: 13px;
            margin: 0 1em;box-shadow: 0px -1px 13px 10px black;">
        </article>
        <hr class="subDIVIDER">
        <header style="display: flex;">
            <h4 style="margin: 0.888em 0 1em 1em;">üçø UPLOAD (wav to txt):</h4>
        </header>
        <!--aside style="height: 2em;padding: 4px;
             border-radius: 10px;margin: 0.444em 0 0 1em;
             display:flex;justify-content: space-around;
             box-shadow: inset -1px -1px 4px 1px rgb(83, 93, 204);">
             <button  class="subBtn" onclick="uploadWAV()" style="border-radius:8px;
             background:grey; height: 2em;
             cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
             <span style="border-radius:100%;background:limegreen;
                 border:1px solid grey;">
             üéà</span><span style="color:black;" class="btnTXT hoverTXT">UPLOAD</span>
             </button>
             <button  class="subBtn" onclick="transcribeWAV()" style="border-radius:8px;
             background:grey; height: 2em;
             cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
             <span style="border-radius:100%;background:limegreen;
                 border:1px solid grey;">
             üíé</span><span style="color:black;" class="btnTXT hoverTXT">TRANSCRIBE</span>
             </button>
        </aside-->

        <input type="file" id="audioFile"  class="subBtn" accept="audio/*"
        style="    border-radius: 13px;color:steelblue;
        margin: 1em;padding: 1.444em;width: 80%;
        box-shadow: 0px 2px 0px 10px black;">
        <!--button id="playBtn"  class="subBtn"style="border-radius:8px;
        background:grey; height: 2em;
        cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
        <span style="border-radius:100%;background:limegreen;
            border:1px solid grey;">
        ‚ñ∂Ô∏è</span><span style="color:black;" class="btnTXT hoverTXT">PLAY</span></button-->
        <audio id="audioPlayer" controls style="margin: 1em auto; display: flex;
        box-shadow: 1px 1px 8px 4px lime;
        border-radius: 40px;"></audio>
        <aside  style="    border-radius: 13px;color:steelblue;
        margin: 1em;padding: 1.444em;width: 80%;
        box-shadow: 0px 2px 0px 10px black;">
            <label for="speedControl">Speed:</label>
            <select id="speedControl" style="color: steelblue;
            background: black;
            border-radius: 8px;
            width: 8em;
            text-align: center;">
                <option value="1.0" selected>1.0x</option>
                <option value="1.5">1.5x</option>
                <option value="2.0">2.0x</option>
                <option value="2.5">2.5x</option>
                <option value="3">3.0x</option>
                <option value="4">4.0x</option>
                <option value="10">10.0x</option>
                <option value="100">100.0x</option>
            </select>
        </aside>
        <script>
            //----------AUDIO PLAYER CONTROLS --------------------------
            const audioFile = document.getElementById('audioFile');
            // const playButton = document.getElementById('playBtn');
            const audioPlayer = document.getElementById('audioPlayer');
            audioFile.addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    const audioBlob = new Blob([event.target.result], { type: 'audio/wav' }); // Adjust type as needed
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayer.src = audioUrl;
                };
                reader.readAsArrayBuffer(file);
            });


            //-- PLAYBACK SPEED SETTING -----------------------
            // const audio = document.getElementById('myAudio');
            const speedControl = document.getElementById('speedControl');

            speedControl.addEventListener('change', () => {
                audioPlayer.playbackRate = parseFloat(speedControl.value);
            });
            // playButton.addEventListener('click', () => {
            //     audioPlayer.play();
            // });
        </script>
    </main>
    </section>
    </main>
      <footer style="display:flex;justify-content:space-evenly;width:90%;margin:0 auto; 
      margin-bottom:0.666%;
      flex: 0 0 auto;
      background-image: linear-gradient(grey, steelblue, black);
      box-shadow:0 0 14px 0px steelblue;border-radius:13px;">
      <button class="mainBtn" onclick="showINFO()" style="border-radius:8px;
         background:grey; 
         cursor:pointer;box-shadow: inset 0px 0px 10px 0px blue;">
         <span style="border-radius:100%;background:blue;
           border:1px solid grey;">
         üé≠</span><span class="btnTXT hoverTXT">INFO</span>
      </button>
       <button class="mainBtn" class="" onclick="allChatFn()" style="border-radius:8px;background:grey;
          cursor:pointer;box-shadow: inset -1px -1px 4px 1px aqua;">
          <span style="border-radius:100%;background:aqua;border:1px solid grey;">
            üè∞</span> <span class="btnTXT hoverTXT">ALL TXTz</span>
       </button>
      </footer>
      <legal style="color:darkslategray;font-size: 0.666em;
      display:flex;flex: 0 0 auto;">copyright 2020-
      <span id="dateTXTStamp"></span>
      <script>
        const dateTXTStamp = document.getElementById('dateTXTStamp');
        dateTXTStamp.innerHTML = new Date().getFullYear();</script>
      
      &nbsp; netcinematics, all rights reserved.</legal>
<script>
 
//----------------------------------DATE-TIME------------
const currentDate = new Date();
const year = currentDate.getFullYear();
const month = (currentDate.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 because months are zero-indexed
const day = currentDate.getDate().toString().padStart(2, '0');
let current_ymd = `YMD_${year}_${month}_${day}`;
let current_sig = `~:)`;
//-------------------------------------UI-----------------------
let textareaFrame = document.getElementById('textareaFrame');
let textareaBOX = document.getElementById('textareaBOX');
let allchatBOX = document.getElementById('allchatBOX');
let audioBOX = document.getElementById('audioBOX');
let infoBOX = document.getElementById('infoBOX');
let textareaTXT = [], selectedTXT='';
let recBtnTXT = document.getElementById('recBtnTXT');
let recBtnAUDIO = document.getElementById('recBtnAUDIO');
let RecTime = document.getElementById('RecTime');
let RecWavTimer = document.getElementById('RecWavTimer');
let NotRecWav = document.getElementById('NotRecWav');
let speakBtn = document.getElementById('speakBtn');
let stateRecordingBox = document.getElementById('recordingBox');
let stateListeningBox = document.getElementById('listeningBox');
let stateNotListeningBox = document.getElementById('notlisteningBox');
let isListening = false;
let isRecording = false;
let stateErrorBox = document.getElementById('errorBox');
let stateSavedBox = document.getElementById('savedBox');
let stateCopiedBox = document.getElementById('copiedBox');
let transcript, txtline, txttgt;
let all_chat_docs = [], chat_doc = {};
let txtBOXLineNumber = 0;
let ai_corpus = '';
//------------------------------AI----------------
let recognition = new webkitSpeechRecognition() || new SpeechRecognition();
let TXTRecordingState = 0; //hotmic loop timeout
//INIT SPEECH RECOGNITION
recognition.onstart = () => { //------------------LISTENING
    TXTRecordingState = 1; //for hot mic loop timeout.
    toggleTranscribeState(true);
}
recognition.onresult = (e) => {//---------------END RECORD
    transcript = e.results[0][0].transcript;
    textareaTXT.push(transcript)
    textareaBOX.value = textareaTXT.join('\n');
    toggleTranscribeState(false);
    txtBOXLineNumber = textareaTXT.length;
    if(txtBOXLineNumber===1){ //skip title line
        console.log('skip autosave on title line')
    } else { //autosave 
        saveChatLocalStorageFn();
    }
}
recognition.onend = () => {
    if(TXTRecordingState === 0){
        console.log('rec ended');
        return;
    } else{ //keep mic hot until stopped.
        recognition.start(); 
    }
    // TXTRecordingState++; //for hot mic loop timeout.
    // console.log('rec loop',TXTRecordingState)
    // if(TXTRecordingState < 10){
    //     recognition.start(); //keep mic hot until stopped.
    // }else{
    //     console.log('rec loop limit');
    //     TXTRecordingState = 0;
    // }
};
recognition.addEventListener("error", (event) => {
    console.error(`Speech recognition error TRY CHROME browser: ${event.error}`);
    stopTXTRecord();
}); 
//END INIT SPEECH RECOGNITION---------------------------
//----------------------------USR MSG -------------
let showUSRMSG = (msg) => {
    stateErrorBox.innerHTML = msg;
    stateErrorBox.style.display = "inline";
    stateListeningBox.style.display = "none";
    stateNotListeningBox.style.display = "none";
    setTimeout( ()=>{
        stateErrorBox.style.display = "none";
        stateListeningBox.style.display = "none";
        stateNotListeningBox.style.display = "inline";  
        selectedTXT = '';
    },3000);
}

//----------------------------end USR MSG -------------
//------------------------------SCREEN----------------
const screenHeight = window.innerHeight;
const screenWidth = window.innerWidth;
//------------------------------END APP VARIABLES----------------
let showTXT = () => {
    infoBOX.classList.add('hiddenTab')
    audioBOX.classList.add('hiddenTab')
    allchatBOX.classList.add('hiddenTab')
    textareaFrame.classList.remove('hiddenTab')
}
let showAUDIO = () => {
    infoBOX.classList.add('hiddenTab')
    audioBOX.classList.remove('hiddenTab')
    allchatBOX.classList.add('hiddenTab')
    textareaFrame.classList.add('hiddenTab')
}
showAUDIO(); //set default view, init tab ---------------------

let showINFO = () => {
    if(infoBOX.classList.contains('hiddenTab') ){
        infoBOX.classList.remove('hiddenTab')
        audioBOX.classList.add('hiddenTab')
        allchatBOX.classList.add('hiddenTab')
        textareaFrame.classList.add('hiddenTab')
    } else {
        infoBOX.classList.add('hiddenTab')
        audioBOX.classList.add('hiddenTab')
        allchatBOX.classList.add('hiddenTab')
        textareaFrame.classList.remove('hiddenTab')
    }
}
let saveCHAT = () => {
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    saveChatLocalStorageFn();

    //set txt page
    // infoBOX.classList.add('hiddenTab')
    // audioBOX.classList.add('hiddenTab')
    // allchatBOX.classList.add('hiddenTab')
    // textareaFrame.classList.remove('hiddenTab')
    //show saved MSG
    stateSavedBox.style.display = "inline";
    stateNotListeningBox.style.display = "none";
    setTimeout(()=>{
        stateSavedBox.style.display = "none";
        stateListeningBox.style.display = "none";
        stateNotListeningBox.style.display = "inline";
    },3000);
}
let recTXT = () => {
    //set txt page
    // infoBOX.classList.add('hiddenTab')
    // allchatBOX.classList.add('hiddenTab')
    // textareaFrame.classList.remove('hiddenTab')    
    transcribeTXT();
}
let recAUDIO = async () => {
    if(isRecording){ return; } //exit do nothing
    recordVoice();
    await toggleAutoLock(true); //on : disallow screen lock
    //set data page
    // infoBOX.classList.add('hiddenTab')
    // allchatBOX.classList.remove('hiddenTab')
    // textareaFrame.classList.add('hiddenTab')    
}

let transcribeTXT = () => {
    // if(textareaFrame.classList.contains('hiddenTab')){//not visible, make visible.
    //     infoBOX.classList.add('hiddenTab')
    //     allchatBOX.classList.add('hiddenTab')
    //     textareaFrame.classList.remove('hiddenTab')
    //     return;
    // }

    recognition.start();
}
/*--------------------------------------RECORD-VOICE------------*/
let unsavedRECS = [];
let mediaRecorder = null;
let rec_idx = 0;//feature, universal sequence idx (simplification);
function recordVoice () {
    let audioChunks = [];
    let audioBlob = null;
    toggleRecordState(!isRecording) //!recording is toggle behavior
    navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
        };
        mediaRecorder.onstop = () => {
            // audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            rec_idx++;
            unsavedRECS[rec_idx] = audioBlob;
            audioChunks = [];
            renderAllAudiosMenu();
            stream.getTracks().forEach(t => t.stop());//remove mic use icon on tab.
        };
        mediaRecorder.start();
    })
    .catch(error => {
      console.error('Error accessing microphone:', error);
    });
 
}
let stopAUDIORecord = async () => {
    // console.log('Stop REC voice')
    toggleRecordState(false);
    if(mediaRecorder){mediaRecorder.stop();}
    await toggleAutoLock(false); //off : allow screen lock
    //set data page
    // infoBOX.classList.add('hiddenTab')
    // allchatBOX.classList.remove('hiddenTab')
    // textareaFrame.classList.add('hiddenTab');
}
function saveAudio(rec_idx) {
    if(!rec_idx){return false}
    let audioBlob =  unsavedRECS[rec_idx]
    if (audioBlob) {
        const url = URL.createObjectURL(audioBlob);
        const a = document.createElement('a');
        const recInputElem = document.getElementById('RecINPUT_'+rec_idx);
        const recSAVE_FILE_NAME = recInputElem.value || 'voice_'+rec_idx;
        a.style.display = 'none';
        a.href = url;
        a.download = `${recSAVE_FILE_NAME}_${new Date().toISOString().replace(/:/g, '-')}.wav`;
        // a.download = `${recSAVE_FILE_NAME}_${new Date().toISOString().replace(/:/g, '-')}.webm`;
        // a.download = `save_voice_${new Date().toISOString().replace(/:/g, '-')}.webm`;
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(url);
        document.body.removeChild(a);
    } else { return false}
    return true;
}
//-------------------------------------------TOGGLE AUTO LOCK for RECORD------------------
let wakeLockSentinel = null;
/**
 * Toggles the screen wake lock functionality
 * @param {boolean} shouldKeepAwake - If true, prevents screen from sleeping; if false, allows normal timeout behavior
 * @returns {Promise<boolean>} - Returns true if the requested state was successfully set, false otherwise
 */
 async function toggleAutoLock(shouldKeepAwake) {
    // Check if the Wake Lock API is supported
    if (!('wakeLock' in navigator)) {
        setTimeout(showUSRMSG('‚ö†Ô∏è No Wake Lock'),3000);
        console.warn('Wake Lock API is not supported in this browser');
        return false;
    }
    try {
        if (shouldKeepAwake) { // Only request a new wake lock if we don't already have one
            if (!wakeLockSentinel) {
                wakeLockSentinel = await navigator.wakeLock.request('screen');
                setTimeout(showUSRMSG('Wake Lock OFF'),3000);
                // Add a listener to reacquire the wake lock if the page becomes visible again
                document.addEventListener('visibilitychange', async () => {
                    if (wakeLockSentinel !== null && document.visibilityState === 'visible') {
                        wakeLockSentinel = await navigator.wakeLock.request('screen');
                    }
                });
            }
        } else {
            // Release the wake lock if it exists
            if (wakeLockSentinel) {
                setTimeout(showUSRMSG('Wake Lock ON'),3000);
                await wakeLockSentinel.release();
                wakeLockSentinel = null;
            }
        }
        
        return true;
    } catch (error) {
        console.error('Error toggling wake lock:', error);
        return false;
    }
}
/*
// Example usage:
// Keep screen awake
// await toggleAutoLock(true);

// Allow screen to sleep
// await toggleAutoLock(false);
*/

/*--------------------------------------END RECORD-VOICE------------*/
let toggleTranscribeState = (state) => { 
    if(state){//LISTENING
        isListening = true;
        stateListeningBox.style.display = "inline";
        stateRecordingBox.style.display = "none";   
        stateNotListeningBox.style.display = "none";   
        stateErrorBox.style.display = "none";   
        recBtnTXT.classList.add('recGlow')
    }else{ //NOT LISTENING
        isListening = false;
        stateRecordingBox.style.display = "none";
        stateListeningBox.style.display = "none";
        stateNotListeningBox.style.display = "inline";
        stateErrorBox.style.display = "none";        
        recBtnTXT.classList.remove('recGlow')
    }
}
let toggleRecordState = (state) => { 
    if(state){//RECORDING
        isRecording = true;
        stateRecordingBox.style.display = "inline";
        // stateListeningBox.style.display = "inline";
        stateNotListeningBox.style.display = "none";
        // stateErrorBox.style.display = "none";
        recBtnAUDIO.classList.add('recGlow')
        toggleAUDIOTimer(true);
    }else{ //NOT RECORDING
        isRecording = false;
        stateRecordingBox.style.display = "none";
        stateNotListeningBox.style.display = "inline";
        // stateErrorBox.style.display = "none";
        recBtnAUDIO.classList.remove('recGlow')
        toggleAUDIOTimer(false);
    }
}
let timerInterval;
let toggleAUDIOTimer = (state) => { 
    if(state){ //show time
        let seconds=0,minutes=0,extraSeconds=0,displayMinutes=0,displaySeconds=0; // Set initial time in seconds
        
        RecWavTimer.style.display="inline";
        NotRecWav.style.display="none";
        timerInterval = setInterval(()=>{
            seconds++;
            minutes = Math.floor(seconds / 60);
            remainingSeconds = seconds % 60;
            displayMinutes = (minutes < 10 ? '0' : '') + minutes;
            displaySeconds = (remainingSeconds < 10 ? '0' : '') + remainingSeconds;
            RecTime.textContent = `${displayMinutes}:${displaySeconds}`;
        },1000)

    }else{ //hide timer
        RecWavTimer.style.display="none";
        NotRecWav.style.display="inline";
        clearInterval(timerInterval);//stop timer
        RecTime.textContent = `00:00`;
    }
}
let stopTXTRecord = () => { 
    TXTRecordingState = 0; //hot mic loop timeout
    recognition.stop(); //stop TXT
    // stopRecordVoice(); //stop mp
    toggleTranscribeState(false);
}
let primeFn = () => {
    selectedTXT = textareaBOX.value.substring(textareaBOX.selectionStart, textareaBOX.selectionEnd);
    if(selectedTXT){
        function formatPrimeKey() {// Replace spaces with underscores
            let addEndSpace = false;
            if(selectedTXT.charAt(selectedTXT.length-1)===' '){addEndSpace=true;}
            transcript = selectedTXT.replace(/[ ]/g, '_');
            transcript = transcript.replace(/[^a-zA-Z_]+/g, '');
            transcript = `_${transcript}_`; //Wrap in _
            transcript = transcript.replace(/__/g, '_');
            transcript = (addEndSpace)?transcript+' ':transcript;
        }; formatPrimeKey();
        textareaBOX.value = textareaBOX.value.substring(0, textareaBOX.selectionStart) +
            transcript +
            textareaBOX.value.substring(textareaBOX.selectionEnd);
        textareaBOX.focus();
    }else{ showUSRMSG('‚ö†Ô∏è double click select...') }
}
let omniFn = () => { 
    selectedTXT = textareaBOX.value.substring(textareaBOX.selectionStart, textareaBOX.selectionEnd);
    if(selectedTXT && selectedTXT.indexOf(' ')>-1){
        let addEndSpace = false;
        if(selectedTXT.charAt(selectedTXT.length-1)===' '){addEndSpace=true;}
        transcript = selectedTXT.replace(/ /g,'_')
        transcript = transcript.replace(/[,.!?<>;:|'"-]/g, '');
        transcript = (addEndSpace)?transcript+' ':transcript;
        textareaBOX.value = textareaBOX.value.substring(0, textareaBOX.selectionStart) +
            transcript +
            textareaBOX.value.substring(textareaBOX.selectionEnd);
        textareaBOX.focus();
    }else{ showUSRMSG('‚ö†Ô∏è select text with spaces...') }
}
let alphaFn = () => { 
    selectedTXT = textareaBOX.value.substring(textareaBOX.selectionStart, textareaBOX.selectionEnd);
    if(selectedTXT){
        function formatAlphaKey() {// Replace spaces with underscores
            let addEndSpace = false;
            if(selectedTXT.charAt(selectedTXT.length-1)===' '){addEndSpace=true;}
            transcript = selectedTXT.replace(/[ ]/g, '').toUpperCase();
            transcript = transcript.replace(/[^a-zA-Z_]+/g, '');
            transcript = `a${transcript}a`; //Wrap in _
            transcript = transcript.replace(/aa/g, 'a');
            transcript = (addEndSpace)?transcript+' ':transcript;
        }; formatAlphaKey();
        textareaBOX.value = textareaBOX.value.substring(0, textareaBOX.selectionStart) +
            transcript +
            textareaBOX.value.substring(textareaBOX.selectionEnd);
        textareaBOX.focus();
    }else{ showUSRMSG('‚ö†Ô∏è select any word...') }
}
let sigFn = () => { //author
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')             
    if(textareaTXT && textareaTXT.length>0){
        textareaTXT.push(current_sig);
        textareaBOX.value = textareaTXT.join('\n');
    }             
}
let ymdFn = () => { //year month date end of doc
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')             
    if(textareaTXT && textareaTXT.length>0){
        textareaTXT.push(current_ymd);
        textareaBOX.value = textareaTXT.join('\n');
    }            
}
let hrFn = () => { //add hard rule line at end of doc
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')             
    if(textareaTXT && textareaTXT.length>0){
        textareaTXT.push('<hr></hr>');
        textareaBOX.value = textareaTXT.join('\n');
    }             
}             
         
let hyphenFn = () => { //add hyphen to begin line
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    if(textareaTXT && textareaTXT.length>0){
        if(textareaTXT[textareaTXT.length-1].indexOf('- ')===0){
            txtline = textareaTXT[textareaTXT.length-1].replace('- ','')
        } else {
            txtline = '- '+textareaTXT[textareaTXT.length-1]
        }
        textareaTXT[textareaTXT.length-1] = txtline;
        textareaBOX.value = textareaTXT.join('\n');
        // toggleTranscribeState(false);
        // recognition.stop();
        // stopAllRecord(); //stop 
    }  
}             
let pipeFn = () => { // add pipe to begin line
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    if(textareaTXT && textareaTXT.length>0){
        if(textareaTXT[textareaTXT.length-1].indexOf('| ')===0){
            txtline = textareaTXT[textareaTXT.length-1].replace('| ','')
        } else {
            txtline = '| '+textareaTXT[textareaTXT.length-1]
        }
        textareaTXT[textareaTXT.length-1] = txtline;
        textareaBOX.value = textareaTXT.join('\n');
        // toggleTranscribeState(false);
        // recognition.stop();
        // stopAllRecord(); //stop 
    }              
}             
let undoFn = () => { 
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')             
    if(textareaTXT && textareaTXT.length>0){
        textareaTXT = textareaTXT.slice(0,textareaTXT.length-1)
        textareaBOX.value = textareaTXT.join('\n');
    }
}; 
let setCursorRowFn = ()=>{
    txtBOXLineNumber = textareaBOX.value.substr(0, textareaBOX.selectionStart).split("\n").length;
}        
let titlelineFn = () => {  // Add # to begin line
    // txtBOXLineNumber = textareaBOX.value.substr(0, textareaBOX.selectionStart).split("\n").length;
    console.log('selection start',textareaBOX.selectionStart)
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    debugger; //3 to 6?
    txtBOXLineNumber = textareaBOX.value.substr(0, textareaBOX.selectionStart).split("\n").length;
    if(textareaTXT && textareaTXT.length>0){
        if(txtBOXLineNumber){
            txtline = textareaTXT[txtBOXLineNumber-1]; //SELECTED LINE
        } else {
            txtline = textareaTXT[textareaTXT.length-1]; //LAST LINE
        }
        if(txtline.charAt(0)==='#'){
            if(txtline.charAt(1)==='#'){
                if(txtline.charAt(2)==='#'){// back to blank
                    txtline = txtline.split(' ')
                    txtline = txtline.splice(1,txtline.length).join(' ')
                }else{ //add 3
                    txtline = '#'+txtline;
                }
            }else{ //add 2
                txtline = '#'+txtline;
            }
        }else{ //add 1
            txtline = '# '+txtline;
        }
        if(txtBOXLineNumber){ //SELECTED LINE
            console.log('selection',txtBOXLineNumber) //3 to 6
            textareaTXT[txtBOXLineNumber-1] = txtline;
        } else {//LAST LINE
            textareaTXT[textareaTXT.length-1] = txtline;
        }                
        textareaBOX.value = textareaTXT.join('\n');
        // toggleTranscribeState(false);
        // recognition.stop();
        // stopAllRecord(); //stop 
        setCursorToLine(txtBOXLineNumber); 
    }
};   

let setCursorToLine = (lineNumber) => {
         
    // Split the textarea content into an array of lines
    const lines = textareaBOX.value.split('\n');
    
    // Check if the line number is within bounds
    if (lineNumber > 0 && lineNumber <= lines.length) {
    // Calculate the character position to move to the start of the specified line
    let charPosition = 0;
    for (let i = 1; i < lineNumber; i++) {
            charPosition += lines[i - 1].length + 1; // Add 1 for the newline character
    }
    
    // Set the cursor position
    textareaBOX.selectionStart = charPosition;
    textareaBOX.selectionEnd = charPosition;
    
    // Focus on the textarea to make the cursor visible
    textareaBOX.focus();
    }
}
   
let numberlineFn = () => {  //add 1. to begin line
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    if(textareaTXT && textareaTXT.length>0){
        txtline = textareaTXT[textareaTXT.length-1]
        function incrementNum(inputString) { //regex iteration of number lists
            return inputString.replace(/^(\d+\.)?(.*)$/, function(match, number, rest) {
                if (number === undefined) { // If no number, add "1." at the beginning
                    return "1. " + rest;
                } else {// If number, increment and add back to string
                    return (parseInt(number, 10) + 1) + "." + rest;
                }
            });
        }; 
        txtline = incrementNum(txtline);
        textareaTXT[textareaTXT.length-1] = txtline;
        textareaBOX.value = textareaTXT.join('\n');
        // toggleTranscribeState(false);
        // recognition.stop();
        // stopAllRecord(); //stop 
    }
}
let quotelineFn = () => { //add > to begin line
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    if(textareaTXT && textareaTXT.length>0){
        if(textareaTXT[textareaTXT.length-1].indexOf('> ')===0){
            txtline = textareaTXT[textareaTXT.length-1].replace('> ','')
        } else {
            txtline = '> '+textareaTXT[textareaTXT.length-1]
        }
        textareaTXT[textareaTXT.length-1] = txtline;
        textareaBOX.value = textareaTXT.join('\n');
        // toggleTranscribeState(false);
        // recognition.stop();
        // stopAllRecord(); //stop 
    }
}
let endlineFn = () => {  // add endline chars.
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    if(textareaTXT && textareaTXT.length>0){
        txtline = textareaTXT[textareaTXT.length-1]
        txttgt = txtline.charAt(txtline.length-1)
        if(txttgt==='.'){ txtline=setCharAt(txtline,txtline.length-1,',');
        } else if(txttgt===','){ txtline=setCharAt(txtline,txtline.length-1,'_');
        } else if(txttgt==='_'){ txtline=setCharAt(txtline,txtline.length-1,'?');
        } else if(txttgt==='?'){ txtline=setCharAt(txtline,txtline.length-1,'!');
        } else if(txttgt==='!'){ txtline=setCharAt(txtline,txtline.length-1,'.');
        } else { txtline += '.';}
        textareaTXT[textareaTXT.length-1] = txtline;
        textareaBOX.value = textareaTXT.join('\n');
        // toggleTranscribeState(false);
        // recognition.stop();
        // stopAllRecord(); //stop 
    }
};   
let backChatFn = () => { 
    infoBOX.classList.add('hiddenTab')
    audioBOX.classList.add('hiddenTab')
    allchatBOX.classList.add('hiddenTab')
    textareaFrame.classList.remove('hiddenTab')
}
let newChatFn = () => { 
    infoBOX.classList.add('hiddenTab')
    audioBOX.classList.add('hiddenTab')
    allchatBOX.classList.add('hiddenTab')
    textareaFrame.classList.remove('hiddenTab')
    textareaBOX.value = '# New Chat...'
    textareaTXT = [], selectedTXT='',isListening=false,txtBOXLineNumber = 0;
}
let saveChatLocalStorageFn = () => { // SAVE LOCAL STORAGE on txtup
    txtBOXLineNumber = textareaBOX.value.substr(0, textareaBOX.selectionStart).split("\n").length;
    if(txtBOXLineNumber===1){ //do not auto save title line.
        showUSRMSG('‚ö†Ô∏è Add another line...')
        return
    }
    let updated_doc = false;
    txttgt = getCurrentDocTitle();
    all_chat_docs = (localStorage.all_chat_docs)?
        JSON.parse( localStorage.all_chat_docs ):[];
    chat_doc = new Object();
    chat_doc.title = txttgt;
    chat_doc.txt = textareaBOX.value;               
    for(let i = 0; i<all_chat_docs.length;i++){
        if(all_chat_docs[i].title===txttgt){ //replace
            all_chat_docs[i] = chat_doc
            updated_doc = true;
            break;
        }
    }
    if(!updated_doc){ all_chat_docs.push(chat_doc) } //SAVE TO LOCAL STORAGE
    console.log('Saved in Local Storage')
    localStorage.all_chat_docs = JSON.stringify(all_chat_docs);

    // stateSavedBox.style.display = "inline";
    // stateNotListeningBox.style.display = "none";
    // setTimeout(()=>{
    //     stateSavedBox.style.display = "none";
    //     stateListeningBox.style.display = "none";
    //     stateNotListeningBox.style.display = "inline";
    // },3000);
};  

let copyChatFn = () => {
    // if(allchatBOX.classList.contains('hiddenTab') ){
    // } else { //show notes if hidden
    //     infoBOX.classList.add('hiddenTab')
    //     audioBOX.classList.add('hiddenTab')
    //     allchatBOX.classList.add('hiddenTab')
    //     textareaFrame.classList.remove('hiddenTab')
    // }
    textareaBOX.select();
    transcript = textareaBOX.value;
    navigator.clipboard.writeText(transcript);
    stateCopiedBox.style.display = "inline";
    stateListeningBox.style.display = "none";
    stateNotListeningBox.style.display = "none";
    setTimeout( ()=>{
        stateCopiedBox.style.display = "none";
        stateListeningBox.style.display = "none";
        stateNotListeningBox.style.display = "inline";  
        selectedTXT = '';
    },2000)
    // setTimeout( ()=>{document.getSelection().collapseToEnd()},2000)

    //set txt page
    infoBOX.classList.add('hiddenTab')
    audioBOX.classList.add('hiddenTab')
    allchatBOX.classList.add('hiddenTab')
    textareaFrame.classList.remove('hiddenTab')
};     

let allChatFn = () => { //From AllChats button
    if(allchatBOX.classList.contains('hiddenTab') ){ //show
        allchatBOX.classList.remove('hiddenTab')
        infoBOX.classList.add('hiddenTab')
        audioBOX.classList.add('hiddenTab')
        textareaFrame.classList.add('hiddenTab')
        renderAllChatMenu(); //show data
        renderAllAudiosMenu(); //show data
    } 
    else { //toggle hide
        infoBOX.classList.add('hiddenTab')
        allchatBOX.classList.add('hiddenTab')
        textareaFrame.classList.remove('hiddenTab')
    }
};
//-END-BTN-HANDLERS-------------------------------------------------
//-HELPER_fns-------------------------------------------------------
let getCurrentDocTitle = () => {
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    if(textareaTXT && textareaTXT.length>0){
        return textareaTXT[0];
    }
    return ''
}
let renderAllChatMenu = () => { //reload all doc view
    all_chat_docs = (localStorage.all_chat_docs)?JSON.parse( localStorage.all_chat_docs ):[];
    // if(!all_chat_docs || all_chat_docs.length===0){
    //     all_chat_docs = loadMockData(); }
    const allChatsMenu = document.getElementById('allChatsMenu');
    allChatsMenu.innerHTML='';
    // Map over the array and create buttons
    all_chat_docs.forEach(item => {
        const section1 = document.createElement('section');
        section1.classList.add('docRowBox')
        const button1 = document.createElement('button');
        button1.textContent = item.title;
        button1.classList.add('docTopicBtn')
        button1.onclick = function() { docLookup(item.title); };
        section1.appendChild(button1);
        const button2 = document.createElement('button');
        button2.textContent = 'üóëÔ∏è';
        button2.classList.add('docDeleteBtn')
        button2.classList.add('BtnHover')
        button2.onclick = function() { docDeleteFn(item.title) };
        section1.appendChild(button2);  
        const button5 = document.createElement('button');
        button5.textContent = 'üéá';
        button5.classList.add('docSavedBtn')
        button5.classList.add('BtnHover')
        button5.onclick = function(e) { docLookup(item.title); };
        section1.appendChild(button5);
        allChatsMenu.appendChild(section1);    
    }); 
}
let renderAllAudiosMenu = () => { //reload all doc view
    let all_voice_recs = Object.keys(unsavedRECS);
    const allAudiosMenu = document.getElementById('allAudiosMenu');
    allAudiosMenu.innerHTML='';
    // Map over the array and create buttons
    all_voice_recs.forEach(idx => {
        const section1 = document.createElement('section');
        section1.classList.add('docRowBox')

        const input1 = document.createElement('input');
        input1.id = "RecINPUT_"+idx;
        input1.value = 'voice_'+idx;
        input1.classList.add('recInputTitle')
        // input1.onclick = function() {  };
        section1.appendChild(input1);

        const button2 = document.createElement('button');
        button2.id = "RecDelBtn_"+idx;
        button2.textContent = 'üóëÔ∏è';
        button2.classList.add('docDeleteBtn')
        button2.classList.add('BtnHover')
        button2.onclick = function(e) {
            let idx = e.target.id.split('_')[1];//obj lookup by num idx, name convention 1.
            if(idx){delete unsavedRECS[idx];} //DELETE ITEM
            renderAllAudiosMenu();
        };
        const button5 = document.createElement('button');
        button5.id = "RecDownloadBtn_"+idx;
        // button5.textContent = 'üéá';
        button5.textContent = 'üìÄ save';
        button5.classList.add('docSavedBtn')
        button5.classList.add('BtnHover')
        button5.onclick = function(e) { //---------SAVE AUDIO
            let idx = e.target.id.split('_')[1];//obj lookup by num idx, name convention 1.
            if(saveAudio(idx)){
                if(idx){delete unsavedRECS[idx];} //DELETE ITEM
                renderAllAudiosMenu();
                stateSavedBox.style.display = "inline";
                stateNotListeningBox.style.display = "none";
                setTimeout(()=>{
                    stateSavedBox.style.display = "none";
                    stateListeningBox.style.display = "none";
                    stateNotListeningBox.style.display = "inline";
                },2000);
            } else{

            } 
        };
        section1.appendChild(button5);
        section1.appendChild(button2);  
        allAudiosMenu.appendChild(section1);    
    }); 
}
let docLookup = (text) => { //load txt, and switch to view
    transcript = '';
    all_chat_docs = (localStorage.all_chat_docs)?
        JSON.parse( localStorage.all_chat_docs ):[];
    for(var i=0; i<all_chat_docs.length;i++){
        if(all_chat_docs[i].title===text){
            transcript = all_chat_docs[i].txt;
            break;
        }
    }
    textareaBOX.value = transcript;
    textareaTXT = transcript.split('\n')
    infoBOX.classList.add('hiddenTab')
    audioBOX.classList.add('hiddenTab')
    allchatBOX.classList.add('hiddenTab')
    textareaFrame.classList.remove('hiddenTab') 
} 

let copyCorpusFn = () => { 
    navigator.clipboard.writeText(JSON.stringify(ai_corpus) );
}
let docDeleteFn = (text) => { //lookup, remove from local storage.
    all_chat_docs = (localStorage.all_chat_docs)?
        JSON.parse( localStorage.all_chat_docs ):[];
    for(var i=0; i<all_chat_docs.length;i++){
        if(all_chat_docs[i].title===text){ //-----FOUND DOC
            all_chat_docs.splice(i,1)
            localStorage.all_chat_docs = JSON.stringify(all_chat_docs)
            renderAllChatMenu();
            break; //splice object out
        }
    }
} 
let loadCorpusFromLocalStorage = () => {
    ai_corpus = (localStorage.ai_corpus)?
        JSON.parse( localStorage.ai_corpus ):[];
    }; loadCorpusFromLocalStorage();
    let loadMockData = () => {
    return [
        JSON.parse(
'{"title":"# INTRO GenAI","txt":"# INTRO GenAI\\n- define, explain, describe genai\\n- model types and applications\\n- content: text imagery audio, synthetic data\\n\\n## what is ai, difference ml\\nai is computer science of agents, theory method,\\nmachine learning, trains model, useful predictions.\\nability to learn without explicit programming\\n## supervised and unsupervised\\n- data model input\\n### supervised\\n- labeled data\\n- past examples predict future values.\\n- model predicted output compared to expected output | error\\n- train data does not match predicted data = effor\\n- model reduce error until predicted and training are closer\\n### unsupervised \\n- discovery, cluster, natural groups\\n- unlabeled data - generated example\\n## DEEP LEARING\\n- subset of ML\\n- more complex patterns.\\n-  use artificial neural networks (neuron)\\n- more complex patterns.\\n### supervised, unsupervised, reinforcement, deep learning.\\n- learn to perform tasks, by process data, and make prediction.\\n- Input Layer, Hidden Layer, Output Layer.\\n# CHARTS ( ARTIFICIAL_NEURAL_NETWORKS )\\n - network, sankey, edge bundling, force-directed.\\n - many layers of neruons.\\n## SEMI SUPERVISED LEARNING \\n- use both labeled and unlabled data (sankey)\\n- trained on small labeled data and large unlabled data\\n- basic concepts to general examples.\\n# GENERATIVE AI\\n- subset of ML & Deep Learning\\n## Large language models\\n-  also subset of deep learning.\\n## Discriminative and Generative Deep Learning Models.\\n### Discriminitive\\n- classify and predict from labeled data points\\n- learn relationship between data points by labels\\n- conditional probability distribution (y)\\n- different kinds\\n### Generative\\n- generates new data from training data\\n- learned probability distribution\\n- instances from existing data (new content)\\n"}'                    
        )
    ]
}

let savedInCorpus = (title) => {
    let latestVersion = null;
    for(let i=0; i<ai_corpus.length;i++){
        if(title===ai_corpus[i].title){ 
            latestVersion = ai_corpus[i];
        }
    }
    return latestVersion;
    }
    function setCharAt(str,idx,chr) {
    if(idx > str.length-1) return str;
    return str.substring(0,idx) + chr + str.substring(idx+1);
}        
let keyupTXT = (e) => {
    transcript = textareaBOX.value;
    textareaTXT = transcript.split('\n')
    saveChatLocalStorageFn(); //do not show saved
}
// let showUSRMST = (err) => {
//     console.log(err)
//     stateErrorBox.innerHTML = err;
//     stateErrorBox.style.display = "inline";
//     stateListeningBox.style.display = "none";
//     stateNotListeningBox.style.display = "none";
//     setTimeout( ()=>{
//         stateErrorBox.style.display = "none";
//         stateListeningBox.style.display = "none";
//         stateNotListeningBox.style.display = "inline";  
//         selectedTXT = '';
//     },3000)
// }


// document.addEventListener('keyup', function(event) {
//     if (event.altKey && event.code === 'Backquote') { // Alt + ` is pressed
//         console.log('Hot key [alt+~] : start and stop transcribe.') 
//         if(isListening){
//             stopTXT();
//         } else {
//             transcribeTXT();
//         }
//     }
//     });
 
//--------------------------------------------------VIDEO----------

// const video = document.getElementById('webcam');
// const liveView = document.getElementById('liveView');

// // Check if webcam access is supported.
// function hasGetUserMedia() {
//   return !!(navigator.mediaDevices &&
//     navigator.mediaDevices.getUserMedia);
// }

// Keep a reference of all the child elements we create
// so we can remove them easilly on each render.
// var children = [];


// If webcam supported, add event listener to button for when user
// wants to activate it.
// if (hasGetUserMedia()) {
//   const enableWebcamButton = document.getElementById('webcamButton');
//   enableWebcamButton.addEventListener('click', enableCam);
// } else {
//   console.warn('getUserMedia() is not supported by your browser');
// }


// Enable the live webcam view and start classification.
// function enableCam(event) {
// //   if (!model) {
// //     return;
// //   }
  
//   // Hide the button.
// //   event.target.classList.add('removed');  
// event.target.style.display = 'none';
  
//   // getUsermedia parameters.
//   const constraints = {
//     video: true
//   };

//   // Activate the webcam stream.
//   navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
//     video.srcObject = stream;
//     // video.addEventListener('loadeddata', predictWebcam);
//   });
// }

      </script> 
   </body>
</html>
